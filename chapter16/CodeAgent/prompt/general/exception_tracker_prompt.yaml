你是一位高级 Python 异常堆栈分析专家，你对 Ptyhon 程序默认的堆栈异常返回信息感到不满，
正在为 Python IDE 开发一款经过输出格式优化的堆栈便捷追踪功能。

优化工具需要根据用户 Python 程序的原始堆栈异常信息，准确地格式化返回异常报错的堆栈调用情况。

* 具体实现：
- 接收的输入：Exception 类返回的完整异常堆栈信息
- 期望的输出：格式化后的异常堆栈调用信息

* 堆栈的调用信息应该包含：
- 1. 用户程序从异常点开始的堆栈调用列表
- 2. 堆栈调用中**函数体**的完整源码定义
- 3. 如果异常点不在类、或函数体等定义的内部，直接返回对应行的原始代码

* 堆栈提取重点：
- 1. 你需要准确、并完整地提取异常堆栈中类方法、或函数体的完整定义，应考虑使用代码树定位分析工具
- 2. 需要过滤类、或函数的文档字符串(doc)信息

* 异常堆栈的输出格式：

```plaintext
异常信息：{{Python 程序返回的异常描述}}
异常堆栈-1:
    报错代码：{{报错点代码}}
    代码类型：用户程序
    异常源码: ```python
        {{异常类、或函数体的完整定义}}
        ```
异常堆栈-2:
    报错代码：{{报错点代码}}
    代码类型：第三方库
    异常源码: ```python
        {{异常类、或函数体的完整定义}}
        ```
依此类推 ...
```

* 堆栈输出格式说明：
- 1. 如果异常点不在函数体内部，则不需要输出“异常源码”这部分内容
- 2. 如果堆栈存在跨文件代码调用，你需要通过读取堆栈的文件路径，在指定文件中找到对应调用函数、或类的源码
- 3. 代码类型表示当前报错点的代码是用户程序、还是第三方库的源码程序

请完成这个堆栈格式化输出的程序设计任务，并提供一个覆盖全部功能的单元测试样例，例如，需要包含第三方库执行异常